- name: Add Artifactory apt key
  become: true
  apt_key:
    url:  https://releases.jfrog.io/artifactory/api/gpg/key/public

- name: Add Artifactory Repository
  become: true
  apt_repository:
    repo: deb https://releases.jfrog.io/artifactory/artifactory-debs xenial main

- name: update apt cache
  become: true
  apt:
    update_cache: yes

- name: Install Artifactory
  become: true
  apt:
    name: jfrog-artifactory-oss

- name: Initialize artifactory
  # https://jfrog.com/help/r/jfrog-installation-setup-documentation/artifactory-bootstrap-yaml-file
  become: true
  template: 
    src: artifactory.config.import.yml.j2
    dest: /opt/jfrog/artifactory/var/etc/artifactory/artifactory.config.import.yml

#- name: Change Artifactory port
#  # https://www.jfrog.com/confluence/display/JFROG/Artifactory+System+YAML
#  # https://jfrog.com/help/r/jfrog-installation-setup-documentation/artifactory-system-yaml
#  become: yes
#  template: 
#    src: system.yaml.j2
#    dest: /opt/jfrog/artifactory/var/etc/system.yaml
#    owner: artifactory
#    group: artifactory

#- name: Create artifactory config directory
#  become: true
#  file: 
#    path: /opt/jfrog/artifactory/var/etc/artifactory/
#    owner: artifactory
#    group: artifactory
#    state: directory  

#- name: Create repositories and configure artifactory
#  become: yes
#  template: 
#    src: artifactory.config.import.xml.j2
#    dest: /opt/jfrog/artifactory/var/etc/artifactory/artifactory.config.import.xml
#    owner: artifactory
#    group: artifactory

#- name: Remove disabled init.d startup script
#  become: true
#  file:
#    path: /etc/init.d/artifactory.disabled
#    state: absent

- name: Start Artifactory service
  become: true
  service:
    name: artifactory
    state: started
